<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ïú†ÌäúÎ∏å ÎèôÏòÅÏÉÅ ÎùºÏù¥Î∏åÎü¨Î¶¨</title>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f5f5;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .nav-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-bottom: 30px;
        }

        .nav-btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .nav-btn.active {
            background-color: #667eea;
            color: white;
        }

        .nav-btn:not(.active) {
            background-color: white;
            color: #667eea;
            border: 2px solid #667eea;
        }

        .nav-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .page {
            display: none;
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .page.active {
            display: block;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e1e1;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .btn-danger {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
        }

        .video-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .video-card {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
            display: flex;
            flex-direction: column;
        }

        .video-card:hover {
            transform: translateY(-5px);
        }

        .video-thumbnail {
            width: 100%;
            height: 200px;
            object-fit: cover;
            background-color: #eee;
        }

        .video-info {
            padding: 15px;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }

        .video-title {
            font-weight: 600;
            margin-bottom: 10px;
            color: #333;
        }

        .video-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 10px;
        }

        .meta-tag {
            background: #f0f0f0;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            color: #666;
        }

        .video-actions {
            display: flex;
            gap: 10px;
            margin-top: auto;
        }

        .watch-btn, .copy-btn {
            flex: 1;
        }
        
        .copy-btn {
            background: linear-gradient(135deg, #38b2ac 0%, #319795 100%);
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .data-table th,
        .data-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e1e1e1;
        }

        .data-table th {
            background-color: #f8f9fa;
            font-weight: 600;
        }

        .action-btn {
            padding: 6px 12px;
            margin: 0 2px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }

        .edit-btn {
            background-color: #ffc107;
            color: #000;
        }

        .delete-btn {
            background-color: #dc3545;
            color: white;
        }
        
        .copy-btn-table {
            background-color: #38b2ac;
            color: white;
        }

        .no-results {
            text-align: center;
            padding: 40px;
            color: #666;
            font-size: 18px;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #667eea;
            font-size: 18px;
        }

        .error {
            text-align: center;
            padding: 40px;
            color: #dc3545;
            font-size: 16px;
        }

        /* ÏµúÍ∑º Í≤ÄÏÉâÏñ¥ ÎìúÎ°≠Îã§Ïö¥ Ïä§ÌÉÄÏùº */
        .recent-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #e1e1e1;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            z-index: 1000;
            max-height: 200px;
            overflow-y: auto;
        }

        .recent-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 15px;
            border-bottom: 1px solid #e1e1e1;
            background-color: #f8f9fa;
            border-radius: 8px 8px 0 0;
        }

        .recent-header span {
            font-weight: 600;
            color: #333;
            font-size: 14px;
        }

        .clear-recent {
            background: none;
            border: none;
            color: #666;
            cursor: pointer;
            font-size: 12px;
            padding: 4px 8px;
            border-radius: 4px;
        }

        .clear-recent:hover {
            background-color: #e9ecef;
        }

        .recent-item {
            padding: 10px 15px;
            cursor: pointer;
            border-bottom: 1px solid #f1f1f1;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .recent-item:hover {
            background-color: #f8f9fa;
        }

        .recent-item:last-child {
            border-bottom: none;
        }

        .recent-text {
            color: #333;
            font-size: 14px;
        }

        .recent-delete {
            background: none;
            border: none;
            color: #999;
            cursor: pointer;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 12px;
        }

        .recent-delete:hover {
            background-color: #e9ecef;
            color: #666;
        }

        .status-indicator {
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
        }

        .status-connected {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status-error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .status-success {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üé• Ïú†ÌäúÎ∏å ÎèôÏòÅÏÉÅ ÎùºÏù¥Î∏åÎü¨Î¶¨</h1>
            <p>FirebaseÎ°ú Î™®Îì† Í∏∞Í∏∞ÏóêÏÑú ÎèôÍ∏∞Ìôî</p>
        </div>

        <!-- Ïó∞Í≤∞ ÏÉÅÌÉú ÌëúÏãú -->
        <div id="connection-status" class="status-indicator" style="display: none;"></div>

        <div class="nav-buttons">
            <!-- [ÏàòÏ†ïÎê®] onclick Ìï∏Îì§Îü¨Ïóê this Ï†ÑÎã¨ -->
            <button class="nav-btn active" onclick="showPage('search', this)">üîç Í≤ÄÏÉâ</button>
            <button class="nav-btn" onclick="showPage('manage', this)">‚öôÔ∏è DB Í¥ÄÎ¶¨</button>
        </div>

        <!-- Í≤ÄÏÉâ ÌéòÏù¥ÏßÄ -->
        <div id="search-page" class="page active">
            <h2>ÎèôÏòÅÏÉÅ Í≤ÄÏÉâ</h2>
            <div style="display: flex; gap: 15px; margin-bottom: 20px; align-items: end;">
                <div class="form-group" style="flex: 1; margin-bottom: 0; position: relative;">
                    <label>ÌÜµÌï© Í≤ÄÏÉâ</label>
                    <input type="text" id="unified-search" placeholder="ÎÇòÎùº, ÏßÄÏó≠, Î∏åÎûúÎìú, ÏÉÅÌíàÎ™Ö, ÌÉúÍ∑∏Î°ú Í≤ÄÏÉâÌïòÏÑ∏Ïöî" 
                           oninput="handleRealTimeSearch()" onkeypress="handleEnterKey(event)" onfocus="showRecentSearches()" onblur="hideRecentSearches()">
                    
                    <!-- ÏµúÍ∑º Í≤ÄÏÉâÏñ¥ ÎìúÎ°≠Îã§Ïö¥ -->
                    <div id="recent-searches" class="recent-dropdown" style="display: none;">
                        <div class="recent-header">
                            <span>ÏµúÍ∑º Í≤ÄÏÉâÏñ¥</span>
                            <button onclick="clearRecentSearches()" class="clear-recent">Ï†ÑÏ≤¥ÏÇ≠Ï†ú</button>
                        </div>
                        <div id="recent-list"></div>
                    </div>
                </div>
                <button class="btn" onclick="searchVideos()" style="height: 46px;">Í≤ÄÏÉâ</button>
            </div>

            <!-- Í≤ÄÏÉâ Í≤∞Í≥º Í∞úÏàò -->
            <div id="search-count" style="margin-bottom: 15px; color: #666; display: none;">
                <span id="result-count">0</span>Í∞úÏùò Í≤ÄÏÉâ Í≤∞Í≥º
            </div>

            <div id="search-results">
                <div class="loading">FirebaseÏóêÏÑú Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨Ïò§Îäî Ï§ë...</div>
            </div>
        </div>

        <!-- DB Í¥ÄÎ¶¨ ÌéòÏù¥ÏßÄ -->
        <div id="manage-page" class="page">
            <h2>DB Í¥ÄÎ¶¨</h2>
            
            <div class="form-group">
                <label>Ïú†ÌäúÎ∏å URL *</label>
                <input type="url" id="youtube-url" placeholder="https://www.youtube.com/watch?v=..." required>
            </div>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                <div class="form-group">
                    <label>ÎÇòÎùº</label>
                    <input type="text" id="country" placeholder="Ïòà: ÏùºÎ≥∏">
                </div>
                <div class="form-group">
                    <label>ÏßÄÏó≠</label>
                    <input type="text" id="region" placeholder="Ïòà: ÎèÑÏøÑ">
                </div>
                <div class="form-group">
                    <label>Î∏åÎûúÎìú</label>
                    <input type="text" id="brand" placeholder="Ïòà: Ïä§ÌÉÄÎ≤ÖÏä§">
                </div>
                <div class="form-group">
                    <label>ÏÉÅÌíàÎ™Ö</label>
                    <input type="text" id="product" placeholder="Ïòà: ÏÇ¨Ïø†Îùº ÎùºÎñº">
                </div>
                <div class="form-group">
                    <label>ÌÉúÍ∑∏</label>
                    <input type="text" id="tag" placeholder="Ïòà: Î¶¨Î∑∞, ÎßõÏßë">
                </div>
            </div>

            <div style="margin: 20px 0;">
                <button class="btn" onclick="addVideo()" id="add-btn">Ï∂îÍ∞Ä</button>
                <button class="btn" onclick="updateVideo()" id="update-btn" style="display: none;">ÏàòÏ†ï</button>
                <button class="btn btn-danger" onclick="cancelEdit()" id="cancel-btn" style="display: none;">Ï∑®ÏÜå</button>
            </div>

            <div id="manage-status"></div>

            <table class="data-table">
                <thead>
                    <tr>
                        <th>Ïú†ÌäúÎ∏å URL</th>
                        <th>ÎÇòÎùº</th>
                        <th>ÏßÄÏó≠</th>
                        <th>Î∏åÎûúÎìú</th>
                        <th>ÏÉÅÌíàÎ™Ö</th>
                        <th>ÌÉúÍ∑∏</th>
                        <th>Ïï°ÏÖò</th>
                    </tr>
                </thead>
                <tbody id="data-table-body">
                    <tr>
                        <td colspan="7" class="loading">FirebaseÏóêÏÑú Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨Ïò§Îäî Ï§ë...</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <script>
        // Ï†ÑÏó≠ Î≥ÄÏàò
        let db = null;
        let auth = null;
        let videos = [];
        let editingIndex = -1;
        let editingId = null;
        let recentSearches = JSON.parse(localStorage.getItem('recentSearches')) || [];
        let searchTimeout = null;
        let isLoading = false;

        // Firebase Ï¥àÍ∏∞Ìôî
        async function initFirebase() {
            const firebaseConfig = {
                apiKey: "AIzaSyDF70fNUcEba4YQCLpGiPq75P9_gh9T6kY",
                authDomain: "utube-ebd4e.firebaseapp.com",
                projectId: "utube-ebd4e",
                storageBucket: "utube-ebd4e.appspot.com",
                messagingSenderId: "7974965672",
                appId: "1:7974965672:web:862548a6a5be4093988d9d",
                measurementId: "G-PDZX6N7NNJ"
            };

            try {
                if (!firebase.apps.length) {
                    firebase.initializeApp(firebaseConfig);
                }
                
                db = firebase.firestore();
                auth = firebase.auth();

                // ÏùµÎ™Ö Î°úÍ∑∏Ïù∏
                await auth.signInAnonymously();
                console.log("Firebase ÏùµÎ™Ö Î°úÍ∑∏Ïù∏ ÏÑ±Í≥µ");
                
                showConnectionStatus("FirebaseÏóê Ïó∞Í≤∞ÎêòÏóàÏäµÎãàÎã§", "connected");
                
                // Îç∞Ïù¥ÌÑ∞ Î°úÎìú
                await loadVideosFromFirestore();
                
            } catch (error) {
                console.error("Firebase Ï¥àÍ∏∞Ìôî Ïã§Ìå®:", error);
                showConnectionStatus("Firebase Ïó∞Í≤∞ Ïã§Ìå®: " + error.message, "error");
                showOfflineMessage();
            }
        }

        // Ïó∞Í≤∞ ÏÉÅÌÉú ÌëúÏãú
        function showConnectionStatus(message, type) {
            const statusElement = document.getElementById('connection-status');
            statusElement.textContent = message;
            statusElement.className = 'status-indicator status-' + type;
            statusElement.style.display = 'block';
            
            if (type === 'connected') {
                setTimeout(() => {
                    statusElement.style.display = 'none';
                }, 3000);
            }
        }

        // Í¥ÄÎ¶¨ ÏÉÅÌÉú ÌëúÏãú
        function showManageStatus(message, type) {
            const statusElement = document.getElementById('manage-status');
            statusElement.textContent = message;
            statusElement.className = 'status-indicator status-' + type;
            statusElement.style.display = 'block';
            
            setTimeout(() => {
                statusElement.style.display = 'none';
            }, 3000);
        }

        // Ïò§ÌîÑÎùºÏù∏ Î©îÏãúÏßÄ ÌëúÏãú
        function showOfflineMessage() {
            document.getElementById('search-results').innerHTML = '<div class="error">Firebase Ïó∞Í≤∞Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§. Ïù∏ÌÑ∞ÎÑ∑ Ïó∞Í≤∞ÏùÑ ÌôïÏù∏Ìï¥Ï£ºÏÑ∏Ïöî.</div>';
            document.getElementById('data-table-body').innerHTML = '<tr><td colspan="7" class="error">Firebase Ïó∞Í≤∞Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.</td></tr>';
        }

        // FirestoreÏóêÏÑú ÎèôÏòÅÏÉÅ Îç∞Ïù¥ÌÑ∞ Î°úÎìú
        async function loadVideosFromFirestore() {
            if (!db) {
                console.error("FirestoreÍ∞Ä Ï¥àÍ∏∞ÌôîÎêòÏßÄ ÏïäÏïòÏäµÎãàÎã§.");
                return;
            }

            try {
                isLoading = true;
                console.log("FirestoreÏóêÏÑú ÎèôÏòÅÏÉÅ Îç∞Ïù¥ÌÑ∞ Î°úÎìú ÏãúÏûë...");
                
                const snapshot = await db.collection('youtube_videos').orderBy('createdAt', 'desc').get();
                
                videos = [];
                snapshot.forEach(doc => {
                    videos.push({
                        id: doc.id,
                        ...doc.data()
                    });
                });

                console.log('FirestoreÏóêÏÑú Î°úÎìúÎêú ÎèôÏòÅÏÉÅ Ïàò:', videos.length);
                
                // UI ÏóÖÎç∞Ïù¥Ìä∏
                resetSearchResults();
                loadDataTable();
                
            } catch (error) {
                console.error('FirestoreÏóêÏÑú Îç∞Ïù¥ÌÑ∞ Î°úÎìú Ïã§Ìå®:', error);
                showConnectionStatus("Îç∞Ïù¥ÌÑ∞ Î°úÎìú Ïã§Ìå®: " + error.message, "error");
            } finally {
                isLoading = false;
            }
        }

        // FirestoreÏóê ÎèôÏòÅÏÉÅ Ï∂îÍ∞Ä
        async function addVideoToFirestore(videoData) {
            if (!db) {
                alert('FirebaseÏóê Ïó∞Í≤∞ÎêòÏßÄ ÏïäÏïòÏäµÎãàÎã§.');
                return false;
            }

            try {
                const docData = {
                    ...videoData,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                };
                
                const docRef = await db.collection('youtube_videos').add(docData);
                console.log("Î¨∏ÏÑúÍ∞Ä Ï∂îÍ∞ÄÎêòÏóàÏäµÎãàÎã§. ID:", docRef.id);
                
                // Î°úÏª¨ Î∞∞Ïó¥ÏóêÎèÑ Ï∂îÍ∞Ä
                videos.unshift({
                    id: docRef.id,
                    ...videoData,
                    createdAt: new Date()
                });
                
                return true;
            } catch (error) {
                console.error("FirestoreÏóê Ï∂îÍ∞Ä Ïã§Ìå®:", error);
                alert('Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû•Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§: ' + error.message);
                return false;
            }
        }

        // FirestoreÏóêÏÑú ÎèôÏòÅÏÉÅ ÏóÖÎç∞Ïù¥Ìä∏
        async function updateVideoInFirestore(id, videoData) {
            if (!db) {
                alert('FirebaseÏóê Ïó∞Í≤∞ÎêòÏßÄ ÏïäÏïòÏäµÎãàÎã§.');
                return false;
            }

            try {
                const docData = {
                    ...videoData,
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                };
                
                await db.collection('youtube_videos').doc(id).update(docData);
                console.log("Î¨∏ÏÑúÍ∞Ä ÏóÖÎç∞Ïù¥Ìä∏ÎêòÏóàÏäµÎãàÎã§. ID:", id);
                
                // Î°úÏª¨ Î∞∞Ïó¥ÏóêÏÑúÎèÑ ÏóÖÎç∞Ïù¥Ìä∏
                const index = videos.findIndex(v => v.id === id);
                if (index !== -1) {
                    videos[index] = { ...videos[index], ...videoData };
                }
                
                return true;
            } catch (error) {
                console.error("Firestore ÏóÖÎç∞Ïù¥Ìä∏ Ïã§Ìå®:", error);
                alert('Îç∞Ïù¥ÌÑ∞ ÏàòÏ†ïÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§: ' + error.message);
                return false;
            }
        }

        // FirestoreÏóêÏÑú ÎèôÏòÅÏÉÅ ÏÇ≠Ï†ú
        async function deleteVideoFromFirestore(id) {
            if (!db) {
                alert('FirebaseÏóê Ïó∞Í≤∞ÎêòÏßÄ ÏïäÏïòÏäµÎãàÎã§.');
                return false;
            }

            try {
                await db.collection('youtube_videos').doc(id).delete();
                console.log("Î¨∏ÏÑúÍ∞Ä ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§. ID:", id);
                
                // Î°úÏª¨ Î∞∞Ïó¥ÏóêÏÑúÎèÑ ÏÇ≠Ï†ú
                videos = videos.filter(v => v.id !== id);
                
                return true;
            } catch (error) {
                console.error("Firestore ÏÇ≠Ï†ú Ïã§Ìå®:", error);
                alert('Îç∞Ïù¥ÌÑ∞ ÏÇ≠Ï†úÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§: ' + error.message);
                return false;
            }
        }

        // [ÏàòÏ†ïÎê®] DB Í¥ÄÎ¶¨ ÌéòÏù¥ÏßÄ ÎπÑÎ∞ÄÎ≤àÌò∏ Í∏∞Îä• Ï∂îÍ∞Ä
        function showPage(pageName, buttonElement) {
            // 'manage' ÌéòÏù¥ÏßÄÏóê Ï†ëÍ∑ºÌï† ÎïåÎßå ÎπÑÎ∞ÄÎ≤àÌò∏Î•º Î¨ªÏäµÎãàÎã§.
            if (pageName === 'manage') {
                // Ïù¥ Í≥≥ÏóêÏÑú ÎπÑÎ∞ÄÎ≤àÌò∏Î•º ÏõêÌïòÎäî Í∞íÏúºÎ°ú Î≥ÄÍ≤ΩÌï† Ïàò ÏûàÏäµÎãàÎã§.
                const adminPassword = "1234"; 
                const userInput = prompt("Í¥ÄÎ¶¨Ïûê ÎπÑÎ∞ÄÎ≤àÌò∏Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî:");

                // ÏÇ¨Ïö©ÏûêÍ∞Ä 'Ï∑®ÏÜå'Î•º ÎàÑÎ•¥Í±∞ÎÇò ÏïÑÎ¨¥Í≤ÉÎèÑ ÏûÖÎ†•ÌïòÏßÄ ÏïäÏùÄ Í≤ΩÏö∞
                if (userInput === null || userInput === "") {
                    return; 
                }
                
                // ÎπÑÎ∞ÄÎ≤àÌò∏Í∞Ä ÌãÄÎ¶∞ Í≤ΩÏö∞
                if (userInput !== adminPassword) {
                    alert("ÎπÑÎ∞ÄÎ≤àÌò∏Í∞Ä ÏùºÏπòÌïòÏßÄ ÏïäÏäµÎãàÎã§.");
                    return; // Ìï®ÏàòÎ•º Ï§ëÎã®ÌïòÏó¨ ÌéòÏù¥ÏßÄ Ï†ÑÌôòÏùÑ ÎßâÏäµÎãàÎã§.
                }
            }
            
            // ÎπÑÎ∞ÄÎ≤àÌò∏Í∞Ä ÎßûÍ±∞ÎÇò 'manage' ÌéòÏù¥ÏßÄÍ∞Ä ÏïÑÎãå Í≤ΩÏö∞, ÌéòÏù¥ÏßÄÎ•º Ï†ÑÌôòÌï©ÎãàÎã§.
            document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
            
            document.getElementById(pageName + '-page').classList.add('active');
            buttonElement.classList.add('active');
            
            // 'manage' ÌéòÏù¥ÏßÄÎ°ú Ï†ÑÌôòÎêú Í≤ΩÏö∞, Îç∞Ïù¥ÌÑ∞ ÌÖåÏù¥Î∏îÏùÑ Îã§Ïãú Î°úÎìúÌï©ÎãàÎã§.
            if (pageName === 'manage') {
                loadDataTable();
            }
        }

        // Ïã§ÏãúÍ∞Ñ Í≤ÄÏÉâ Ï≤òÎ¶¨
        function handleRealTimeSearch() {
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(() => {
                const searchTerm = document.getElementById('unified-search').value.trim();
                if (searchTerm.length > 0) {
                    searchVideos(false);
                } else {
                    resetSearchResults();
                }
            }, 300);
        }

        // Í≤ÄÏÉâ Í≤∞Í≥º Ï¥àÍ∏∞Ìôî
        function resetSearchResults() {
            if (isLoading) {
                document.getElementById('search-results').innerHTML = '<div class="loading">Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨Ïò§Îäî Ï§ë...</div>';
            } else if (videos.length === 0) {
                document.getElementById('search-results').innerHTML = '<div class="no-results">Ï†ÄÏû•Îêú ÎèôÏòÅÏÉÅÏù¥ ÏóÜÏäµÎãàÎã§. DB Í¥ÄÎ¶¨ÏóêÏÑú ÎèôÏòÅÏÉÅÏùÑ Ï∂îÍ∞ÄÌï¥Î≥¥ÏÑ∏Ïöî.</div>';
            } else {
                displaySearchResults(videos); // Ï¥àÍ∏∞ ÏÉÅÌÉúÏóêÏÑúÎäî Î™®Îì† ÎπÑÎîîÏò§Î•º ÌëúÏãú
            }
            document.getElementById('search-count').style.display = 'none';
        }

        // Í≤ÄÏÉâ Í∏∞Îä•
        function searchVideos(addToRecent = true) {
            const searchTerm = document.getElementById('unified-search').value.toLowerCase().trim();
            
            if (!searchTerm) {
                resetSearchResults();
                return;
            }

            if (addToRecent) {
                addRecentSearch(searchTerm);
            }

            const filteredVideos = videos.filter(video => {
                return (
                    (video.country && video.country.toLowerCase().includes(searchTerm)) ||
                    (video.region && video.region.toLowerCase().includes(searchTerm)) ||
                    (video.brand && video.brand.toLowerCase().includes(searchTerm)) ||
                    (video.product && video.product.toLowerCase().includes(searchTerm)) ||
                    (video.tag && video.tag.toLowerCase().includes(searchTerm))
                );
            });

            document.getElementById('result-count').textContent = filteredVideos.length;
            document.getElementById('search-count').style.display = 'block';

            displaySearchResults(filteredVideos);
        }

        // ÏóîÌÑ∞ÌÇ§ Í≤ÄÏÉâ ÏßÄÏõê
        function handleEnterKey(event) {
            if (event.key === 'Enter') {
                searchVideos();
            }
        }

        // ÏµúÍ∑º Í≤ÄÏÉâÏñ¥ Ï∂îÍ∞Ä
        function addRecentSearch(searchTerm) {
            recentSearches = recentSearches.filter(item => item !== searchTerm);
            recentSearches.unshift(searchTerm);
            if (recentSearches.length > 10) {
                recentSearches = recentSearches.slice(0, 10);
            }
            localStorage.setItem('recentSearches', JSON.stringify(recentSearches));
        }

        // ÏµúÍ∑º Í≤ÄÏÉâÏñ¥ ÌëúÏãú
        function showRecentSearches() {
            const dropdown = document.getElementById('recent-searches');
            const recentList = document.getElementById('recent-list');
            
            if (recentSearches.length === 0) {
                dropdown.style.display = 'none';
                return;
            }

            let recentHtml = '';
            recentSearches.forEach((search, index) => {
                recentHtml += '<div class="recent-item" onclick="selectRecentSearch(\'' + 
                    search.replace(/'/g, "\\'") + '\')">' +
                    '<span class="recent-text">' + search + '</span>' +
                    '<button class="recent-delete" onclick="event.stopPropagation(); deleteRecentSearch(' + index + ')">√ó</button>' +
                    '</div>';
            });

            recentList.innerHTML = recentHtml;
            dropdown.style.display = 'block';
        }

        // ÏµúÍ∑º Í≤ÄÏÉâÏñ¥ ÏÑ†ÌÉù
        function selectRecentSearch(searchTerm) {
            document.getElementById('unified-search').value = searchTerm;
            hideRecentSearches();
            searchVideos();
        }

        // ÏµúÍ∑º Í≤ÄÏÉâÏñ¥ Í∞úÎ≥Ñ ÏÇ≠Ï†ú
        function deleteRecentSearch(index) {
            recentSearches.splice(index, 1);
            localStorage.setItem('recentSearches', JSON.stringify(recentSearches));
            showRecentSearches();
        }

        // ÏµúÍ∑º Í≤ÄÏÉâÏñ¥ Ï†ÑÏ≤¥ ÏÇ≠Ï†ú
        function clearRecentSearches() {
            recentSearches = [];
            localStorage.setItem('recentSearches', JSON.stringify(recentSearches));
            hideRecentSearches();
        }

        // ÏµúÍ∑º Í≤ÄÏÉâÏñ¥ Ïà®Í∏∞Í∏∞
        function hideRecentSearches() {
            setTimeout(() => {
                document.getElementById('recent-searches').style.display = 'none';
            }, 150);
        }

        // ÎèôÏòÅÏÉÅ Ï∂îÍ∞Ä
        async function addVideo() {
            const youtubeUrl = document.getElementById('youtube-url').value.trim();
            const country = document.getElementById('country').value.trim();
            const region = document.getElementById('region').value.trim();
            const brand = document.getElementById('brand').value.trim();
            const product = document.getElementById('product').value.trim();
            const tag = document.getElementById('tag').value.trim();

            if (!youtubeUrl) {
                alert('Ïú†ÌäúÎ∏å URLÏùÄ ÌïÑÏàòÏûÖÎãàÎã§.');
                return;
            }

            const addBtn = document.getElementById('add-btn');
            addBtn.disabled = true;
            addBtn.textContent = 'Ï∂îÍ∞Ä Ï§ë...';

            const videoData = {
                youtubeUrl: youtubeUrl,
                country: country,
                region: region,
                brand: brand,
                product: product,
                tag: tag
            };

            const success = await addVideoToFirestore(videoData);
            
            if (success) {
                clearForm();
                loadDataTable();
                showManageStatus('ÎèôÏòÅÏÉÅÏù¥ Ï∂îÍ∞ÄÎêòÏóàÏäµÎãàÎã§.', 'success');
            }

            addBtn.disabled = false;
            addBtn.textContent = 'Ï∂îÍ∞Ä';
        }

        // ÎèôÏòÅÏÉÅ ÏàòÏ†ï
        function editVideo(index) {
            editingIndex = index;
            editingId = videos[index].id;
            const video = videos[index];
            
            document.getElementById('youtube-url').value = video.youtubeUrl || '';
            document.getElementById('country').value = video.country || '';
            document.getElementById('region').value = video.region || '';
            document.getElementById('brand').value = video.brand || '';
            document.getElementById('product').value = video.product || '';
            document.getElementById('tag').value = video.tag || '';
            
            document.getElementById('add-btn').style.display = 'none';
            document.getElementById('update-btn').style.display = 'inline-block';
            document.getElementById('cancel-btn').style.display = 'inline-block';
        }

        // ÎèôÏòÅÏÉÅ ÏóÖÎç∞Ïù¥Ìä∏
        async function updateVideo() {
            if (editingIndex === -1 || !editingId) return;
            
            const youtubeUrl = document.getElementById('youtube-url').value.trim();
            if (!youtubeUrl) {
                alert('Ïú†ÌäúÎ∏å URLÏùÄ ÌïÑÏàòÏûÖÎãàÎã§.');
                return;
            }

            const updateBtn = document.getElementById('update-btn');
            updateBtn.disabled = true;
            updateBtn.textContent = 'ÏàòÏ†ï Ï§ë...';

            const videoData = {
                youtubeUrl: youtubeUrl,
                country: document.getElementById('country').value.trim(),
                region: document.getElementById('region').value.trim(),
                brand: document.getElementById('brand').value.trim(),
                product: document.getElementById('product').value.trim(),
                tag: document.getElementById('tag').value.trim()
            };

            const success = await updateVideoInFirestore(editingId, videoData);
            
            if (success) {
                cancelEdit();
                loadDataTable();
                showManageStatus('ÎèôÏòÅÏÉÅÏù¥ ÏàòÏ†ïÎêòÏóàÏäµÎãàÎã§.', 'success');
            }

            updateBtn.disabled = false;
            updateBtn.textContent = 'ÏàòÏ†ï';
        }

        // ÏàòÏ†ï Ï∑®ÏÜå
        function cancelEdit() {
            editingIndex = -1;
            editingId = null;
            clearForm();
            
            document.getElementById('add-btn').style.display = 'inline-block';
            document.getElementById('update-btn').style.display = 'none';
            document.getElementById('cancel-btn').style.display = 'none';
        }

        // ÎèôÏòÅÏÉÅ ÏÇ≠Ï†ú
        async function deleteVideo(index) {
            if (!confirm('Ï†ïÎßêÎ°ú Ïù¥ ÎèôÏòÅÏÉÅÏùÑ ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
                return;
            }

            const videoId = videos[index].id;
            const success = await deleteVideoFromFirestore(videoId);
            
            if (success) {
                loadDataTable();
                showManageStatus('ÎèôÏòÅÏÉÅÏù¥ ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§.', 'success');
            }
        }

        // Ìèº Ï¥àÍ∏∞Ìôî
        function clearForm() {
            document.getElementById('youtube-url').value = '';
            document.getElementById('country').value = '';
            document.getElementById('region').value = '';
            document.getElementById('brand').value = '';
            document.getElementById('product').value = '';
            document.getElementById('tag').value = '';
        }

        // [Ïã†Í∑ú] ÌÅ¥Î¶ΩÎ≥¥Îìú Î≥µÏÇ¨ Ìï®Ïàò
        function copyToClipboard(text, buttonElement) {
            const textArea = document.createElement('textarea');
            textArea.value = text;
            document.body.appendChild(textArea);
            textArea.select();
            try {
                document.execCommand('copy');
                const originalText = buttonElement.innerHTML;
                buttonElement.innerHTML = 'Î≥µÏÇ¨ ÏôÑÎ£å!';
                buttonElement.disabled = true;
                setTimeout(() => {
                    buttonElement.innerHTML = originalText;
                    buttonElement.disabled = false;
                }, 1500);
            } catch (err) {
                console.error('ÌÅ¥Î¶ΩÎ≥¥Îìú Î≥µÏÇ¨ Ïã§Ìå®:', err);
                alert('ÌÅ¥Î¶ΩÎ≥¥Îìú Î≥µÏÇ¨Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.');
            }
            document.body.removeChild(textArea);
        }

        // Í≤ÄÏÉâ Í≤∞Í≥º ÌëúÏãú
        function displaySearchResults(filteredVideos) {
            const resultsContainer = document.getElementById('search-results');
            
            if (filteredVideos.length === 0) {
                resultsContainer.innerHTML = '<div class="no-results">ÌëúÏãúÌï† ÎèôÏòÅÏÉÅÏù¥ ÏóÜÏäµÎãàÎã§.</div>';
                return;
            }

            let html = '<div class="video-grid">';
            filteredVideos.forEach((video) => {
                const videoId = extractVideoId(video.youtubeUrl);
                const thumbnailUrl = videoId ? `https://i.ytimg.com/vi/${videoId}/maxresdefault.jpg` : '';
                const fallbackUrl = videoId ? `https://i.ytimg.com/vi/${videoId}/hqdefault.jpg` : 'https://via.placeholder.com/350x200.png?text=No+Image';
                
                html += `
                    <div class="video-card">
                        <img src="${thumbnailUrl}" alt="Video thumbnail" class="video-thumbnail" onerror="this.onerror=null; this.src='${fallbackUrl}';">
                        <div class="video-info">
                            <div class="video-title">${video.product || 'Ï†úÎ™© ÏóÜÏùå'}</div>
                            <div class="video-meta">
                                ${video.country ? `<span class="meta-tag">üåç ${video.country}</span>` : ''}
                                ${video.region ? `<span class="meta-tag">üìç ${video.region}</span>` : ''}
                                ${video.brand ? `<span class="meta-tag">üè¢ ${video.brand}</span>` : ''}
                                ${video.tag ? `<span class="meta-tag">üè∑Ô∏è ${video.tag}</span>` : ''}
                            </div>
                            <div class="video-actions">
                                <button class="btn watch-btn" onclick="window.open('${video.youtubeUrl}', '_blank')">
                                    üé• ÎèôÏòÅÏÉÅ Î≥¥Í∏∞
                                </button>
                                <button class="btn copy-btn" onclick="copyToClipboard('${video.youtubeUrl}', this)">
                                    üîó ÎßÅÌÅ¨ Î≥µÏÇ¨
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            });
            html += '</div>';
            
            resultsContainer.innerHTML = html;
        }

        // YouTube ÎèôÏòÅÏÉÅ ID Ï∂îÏ∂ú (Shorts Îì± Îã§ÏñëÌïú URL ÌòïÏãù ÏßÄÏõê)
        function extractVideoId(url) {
            if (!url) return null;
            let videoId = null;
            const regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|shorts\/|watch\?v=|\&v=)([^#\&\?]*).*/;
            const match = url.match(regExp);
            if (match && match[2].length === 11) {
                videoId = match[2];
            }
            return videoId;
        }

        // Îç∞Ïù¥ÌÑ∞ ÌÖåÏù¥Î∏î Î°úÎìú
        function loadDataTable() {
            const tableBody = document.getElementById('data-table-body');
            
            if (videos.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="7" class="no-results">Ï†ÄÏû•Îêú ÎèôÏòÅÏÉÅÏù¥ ÏóÜÏäµÎãàÎã§.</td></tr>';
                return;
            }

            let html = '';
            videos.forEach((video, index) => {
                html += `
                    <tr>
                        <td><a href="${video.youtubeUrl}" target="_blank" style="color: #667eea; text-decoration: none;" title="${video.youtubeUrl}">${video.youtubeUrl.substring(0, 50)}...</a></td>
                        <td>${video.country || '-'}</td>
                        <td>${video.region || '-'}</td>
                        <td>${video.brand || '-'}</td>
                        <td>${video.product || '-'}</td>
                        <td>${video.tag || '-'}</td>
                        <td>
                            <button class="action-btn edit-btn" onclick="editVideo(${index})">ÏàòÏ†ï</button>
                            <button class="action-btn delete-btn" onclick="deleteVideo(${index})">ÏÇ≠Ï†ú</button>
                            <button class="action-btn copy-btn-table" onclick="copyToClipboard('${video.youtubeUrl}', this)">Î≥µÏÇ¨</button>
                        </td>
                    </tr>
                `;
            });
            
            tableBody.innerHTML = html;
        }

        // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú Firebase Ï¥àÍ∏∞Ìôî Î∞è Ï¥àÍ∏∞ Îç∞Ïù¥ÌÑ∞ ÌëúÏãú
        window.addEventListener('load', async () => {
            await initFirebase();
            // Î°úÎî©Ïù¥ ÏôÑÎ£åÎêòÎ©¥ Í≤ÄÏÉâ Í≤∞Í≥º ÏòÅÏó≠Ïóê Ï†ÑÏ≤¥ ÎπÑÎîîÏò§ Î™©Î°ùÏùÑ Í∏∞Î≥∏ÏúºÎ°ú ÌëúÏãú
            if (videos.length > 0) {
                displaySearchResults(videos);
            }
        });
    </script>
</body>
</html>
